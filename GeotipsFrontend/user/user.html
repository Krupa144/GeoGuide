<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings - GeoGuider</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/auth.css">
</head>
<body>

   <div class="settings-page-container">
    <div class="card">
        <h2 class="card-title mb-4">
            <i class="bi bi-person-gear"></i> User Settings
        </h2>

        <div id="userInfoDisplay" class="user-info-display mb-3">
            Loading user information...
        </div>
        <div class="button">
            <a href="../menu.html" class="btn btn-secondary w-100">
                <i class="bi bi-house-door-fill"></i> Back to Main Page
            </a>
        </div>
    </div>
</div>


    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const SUPABASE_URL = 'https://zitxawcefyuhfhqnybyg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InppdHhhd2NlZnl1aGZocW55YnlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3ODg3NzAsImV4cCI6MjA2NjM2NDc3MH0.UCZVX7p38R71IIyR8Nl_HY-w5USCl1wg-QhpCiwLgb8';

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const userInfoDisplay = document.getElementById('userInfoDisplay');
        const authActions = document.getElementById('authActions');

        async function updateUIBasedOnAuth(session) {
            if (session) {
                userInfoDisplay.innerHTML = `Your email: <strong>${session.user.email}</strong>`;
                userInfoDisplay.classList.remove('not-logged-in-message'); 
                userInfoDisplay.style.display = 'block'; 

                authActions.innerHTML = `
                    <button class="btn btn-danger" id="logoutButton">
                        <i class="bi bi-box-arrow-right"></i> Log Out
                    </button>
                    `;
                document.getElementById('logoutButton').addEventListener('click', async () => {
                    const { error } = await supabase.auth.signOut();
                    if (error) {
                        console.error('Logout error:', error.message);
                        alert('Logout failed: ' + error.message);
                    } else {
                        window.location.href = '../user/login.html'; 
                    }
                });
            } else {
                userInfoDisplay.innerHTML = `
                    <div class="not-logged-in-message">
                        You are not logged in. <br>
                        <a href="../user/login.html">Login here</a> or <a href="../user/register.html">register an account</a> to manage your settings.
                    </div>
                `;
                userInfoDisplay.style.display = 'block';

                authActions.innerHTML = `
                    <button class="btn btn-primary" onclick="window.location.href='../user/login.html'">
                        <i class="bi bi-box-arrow-in-right"></i> Login
                    </button>
                    <button class="btn btn-success" onclick="window.location.href='../user/register.html'">
                        <i class="bi bi-person-plus"></i> Register
                    </button>
                `;
            }
        }

        async function checkInitialSession() {
            const { data: { session }, error } = await supabase.auth.getSession();
            if (error) {
                console.error('Error fetching session:', error.message);
                userInfoDisplay.innerHTML = `<div class="alert alert-danger">Error loading user data: ${error.message}</div>`;
                userInfoDisplay.style.display = 'block';
            } else {
                updateUIBasedOnAuth(session);
            }
        }

        supabase.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event, session);
            updateUIBasedOnAuth(session);
        });

        checkInitialSession();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>